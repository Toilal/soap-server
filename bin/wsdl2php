#!/usr/bin/env php
<?php
namespace GoetasWebservices\SoapServices\Bin;
use GoetasWebservices\SoapServices\Command\Convert;
use GoetasWebservices\Xsd\XsdToPhp\AbstractConverter;
use Symfony\Component\Config\FileLocator;
use Symfony\Component\Console\Application;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\Loader\XmlFileLoader;

$paths = [
    __DIR__ . '/../vendor/autoload.php',
    __DIR__ . '/../../../autoload.php'
];
foreach ($paths as $path) {
    if (is_file($path)) {
        include $path;
        break;
    }
}

$container = new ContainerBuilder();

$ref = new \ReflectionClass(AbstractConverter::class);
$loader = new XmlFileLoader($container, new FileLocator( dirname($ref->getFileName()). '/Resources/config'));
$loader->load('services.xml');

$loader = new XmlFileLoader($container, new FileLocator(__DIR__ . '/../src/Resources/config'));
$loader->load('services.xml');

error_reporting(error_reporting() & ~E_NOTICE);
$cli = new Application('Convert WSDL definitions to PHP classes Command Line Interface', "1.0");
$cli->setCatchExceptions(true);
$cli->addCommands(array(
    new Convert($container, 'php'),
    new Convert($container, 'jms'),
));
$cli->run();
